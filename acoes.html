<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√ß√µes ‚Äì EcoA√ß√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --p: #2e7d32; --s: #43a047; --bg: #f4f8f6; --white: #ffffff; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); padding-bottom: 50px; }
        header { background: linear-gradient(135deg, #1b5e20, #2e7d32); color: #fff; padding: 20px 5%; display: flex; flex-direction: column; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 100; }
        nav { margin-top: 15px; display: flex; gap: 10px; }
        nav button { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-family: 'Poppins'; }
        .container { max-width: 1100px; margin: 40px auto; padding: 0 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; }
        .pts { font-weight: 700; color: var(--p); background: #f0f7f0; padding: 5px 10px; border-radius: 10px; }
        .btn-enviar { background: var(--p); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: 600; margin-top: 10px; }
        .status-badge { padding: 10px; border-radius: 10px; font-size: 0.8rem; font-weight: 600; margin-top: 10px; }
        .pendente { background: #fffde7; color: #fbc02d; }
        .aprovado { background: #e8f5e9; color: #2e7d32; }
    </style>
</head>
<body>
<header>
    <h1 style="margin:0; font-size:1.5rem;">üå± EcoA√ß√µes Dispon√≠veis</h1>
    <nav>
        <button onclick="location.href='dashboard.html'">Dashboard</button>
        <button onclick="signOut(auth)">Sair</button>
    </nav>
</header>
<div class="container">
    <div class="grid" id="listaAcoes"></div>
</div>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
    const firebaseConfig = { apiKey: "AIzaSyAgKsk6jSIQk7AQ35xmVpnSn84pU8ca0g8", authDomain: "ecoacao-eda80.firebaseapp.com", projectId: "ecoacao-eda80" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const acoes = [
        {nome:'√Ågua: Economizar no banho',pts:20,icon:'üíß'},
        {nome:'Energia: Apagar luzes vadias',pts:20,icon:'üí°'},
        {nome:'Recicla: Separar o lixo',pts:20,icon:'‚ôªÔ∏è'},
        {nome:'Planta: Plantar uma muda',pts:100,icon:'üå≥'},
        {nome:'Social: Convidar um amigo',pts:40,icon:'üì¢'},
        {nome:'Limpeza: Coleta em √°rea verde',pts:50,icon:'üßπ'},
        {nome:'Papel: Usar rascunhos',pts:20,icon:'üìÑ'},
        {nome:'Transporte: Carona ou Bike',pts:40,icon:'üö≤'},
        {nome:'Pl√°stico: Copo reutiliz√°vel',pts:30,icon:'ü•§'},
        {nome:'Recicla: √ìleo de cozinha',pts:50,icon:'üõ¢Ô∏è'}
    ];
    onAuthStateChanged(auth, async user => {
        if (!user) { location.href="login.html"; return; }
        const q = query(collection(db, "acoes_pendentes"), where("uid", "==", user.uid));
        const snap = await getDocs(q);
        const statusMap = {};
        snap.forEach(d => statusMap[d.data().acao] = d.data().status);
        const grid = document.getElementById("listaAcoes");
        acoes.forEach((a, i) => {
            const s = statusMap[a.nome];
            let html = s === 'pendente' ? '<div class="status-badge pendente">‚è≥ Pendente</div>' : 
                       s === 'aprovada' ? '<div class="status-badge aprovado">‚úÖ Conclu√≠do</div>' :
                       `<input type="file" id="f-${i}" style="font-size:0.7rem; margin:10px 0;"><button class="btn-enviar" onclick="enviar(${i})">Enviar</button>`;
            grid.innerHTML += `<div class="card"><div><div style="font-size:2.5rem">${a.icon}</div><h3>${a.nome}</h3><span class="pts">${a.pts} pts</span></div>${html}</div>`;
        });
        window.enviar = async (idx) => {
            const file = document.getElementById(`f-${idx}`).files[0];
            if(!file) return alert("Selecione a foto!");
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async (e) => {
                await addDoc(collection(db, "acoes_pendentes"), { uid:user.uid, email:user.email, acao:acoes[idx].nome, pontos:acoes[idx].pts, status:"pendente", comprovanteBase64: e.target.result, criadoEm: serverTimestamp() });
                alert("Enviado!"); location.reload();
            };
        };
    });
</script>
</body>
</html>
