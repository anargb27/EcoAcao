<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Ranking ‚Äì EcoA√ß√£o Acad√™mica</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#f4f8f6;
}
header{
  background:#2e7d32;
  color:#fff;
  padding:20px;
}
header h1{margin:0}
nav{margin-top:10px}
nav button{
  background:#1b5e20;
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:10px;
  cursor:pointer;
}

main{
  max-width:900px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:18px;
}

table{
  width:100%;
  border-collapse:collapse;
}

th, td{
  padding:12px;
  text-align:left;
}

th{
  background:#e8f5e9;
}

tr:nth-child(even){
  background:#f9f9f9;
}

.rank{
  font-weight:bold;
  color:#2e7d32;
}
</style>
</head>

<body>

<header>
  <h1>üèÜ Ranking EcoA√ß√£o</h1>
  <nav>
    <button onclick="ir('dashboard.html')">Dashboard</button>
    <button onclick="ir('acoes.html')">A√ß√µes</button>
    <button onclick="logout()">Sair</button>
  </nav>
</header>

<main>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Nome</th>
        <th>Curso</th>
        <th>Pontos</th>
      </tr>
    </thead>
    <tbody id="ranking"></tbody>
  </table>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getAuth,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import {
  getFirestore,
  collection,
  query,
  orderBy,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* üî• Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyAgKsk6jSIQk7AQ35xmVpnSn84pU8ca0g8",
  authDomain: "ecoacao-eda80.firebaseapp.com",
  projectId: "ecoacao-eda80",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const tabela = document.getElementById("ranking");

/* üîí Prote√ß√£o */
onAuthStateChanged(auth, (user)=>{
  if(!user){
    window.location.href = "login.html";
    return;
  }

  carregarRanking();
});

/* üèÜ Ranking em tempo real */
function carregarRanking(){
  const q = query(
    collection(db, "usuarios"),
    orderBy("pontos", "desc")
  );

  onSnapshot(q, (snap)=>{
    tabela.innerHTML = "";
    let posicao = 1;

    snap.forEach(doc=>{
      const u = doc.data();

      if(u.admin === true) return; // admin n√£o aparece

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="rank">${posicao}¬∫</td>
        <td>${u.nome}</td>
        <td>${u.curso || "-"}</td>
        <td>${u.pontos || 0}</td>
      `;
      tabela.appendChild(tr);
      posicao++;
    });
  });
}

/* üß≠ Navega√ß√£o */
window.ir = function(p){
  window.location.href = p;
};

/* üö™ Logout */
window.logout = async function(){
  await signOut(auth);
  window.location.href = "login.html";
};
</script>

</body>
</html>
