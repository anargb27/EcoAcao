<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√ß√µes ‚Äì EcoA√ß√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --p: #2e7d32; --s: #43a047; --bg: #f4f8f6; --white: #ffffff; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); padding-bottom: 50px; }
        header { background: linear-gradient(135deg, #1b5e20, #2e7d32); color: #fff; padding: 20px 5%; display: flex; flex-direction: column; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 100; }
        nav { margin-top: 15px; display: flex; gap: 10px; }
        nav button { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-family: 'Poppins'; }
        .container { max-width: 1100px; margin: 40px auto; padding: 0 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; }
        .pts { font-weight: 700; color: var(--p); background: #f0f7f0; padding: 5px 10px; border-radius: 10px; }
        .btn-enviar { background: var(--p); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: 600; margin-top: 10px; }
        .status-badge { padding: 10px; border-radius: 10px; font-size: 0.8rem; font-weight: 600; margin-top: 10px; }
        .pendente { background: #fffde7; color: #fbc02d; }
        .aprovado { background: #e8f5e9; color: #2e7d32; }
    </style>
</head>
<body>
<header>
    <h1 style="margin:0; font-size:1.5rem;">üå± EcoA√ß√µes Dispon√≠veis</h1>
    <nav>
        <button onclick="location.href='dashboard.html'">Dashboard</button>
        <button onclick="signOut(auth)">Sair</button>
    </nav>
</header>
<div class="container">
    <div class="grid" id="listaAcoes"></div>
</div>
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyAgKsk6jSIQk7AQ35xmVpnSn84pU8ca0g8", 
        authDomain: "ecoacao-eda80.firebaseapp.com", 
        projectId: "ecoacao-eda80" 
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const acoes = [
        {nome:'√Ågua: Usar garrafa pr√≥pria (reutiliz√°vel)', pts:15, icon:'ü•§', impacto:'Baixo'},
        {nome:'√Ågua: Reutilizar √Ågua Para Atividade Dom√©sticas', pts:20, icon:'üí¶', impacto:'Baixo'},
        {nome:'√Ågua: Aproveitar a √°gua da chuva', pts:40, icon:'ü™£', impacto:'M√©dio'},
        {nome:'Energia: Apagar luzes de c√¥modos vazios', pts:15, icon:'üí°', impacto:'Baixo'},
        {nome:'Energia: Tirar eletrodom√©sticos da tomada ap√≥s o uso', pts:15, icon:'üîå', impacto:'Baixo'},
        {nome:'Energia: Escolher a escada em vez do elevador', pts:20, icon:'üèÉ', impacto:'Baixo'},
        {nome:'Reciclagem: Separar res√≠duos s√≥lidos', pts:25, icon:'‚ôªÔ∏è', impacto:'Baixo'},
        {nome:'Reciclagem: Encaminhar materiais para coleta seletiva', pts:50, icon:'‚ôªÔ∏è', impacto:'Alto'},
        {nome:'Reciclagem: Juntar pilhas ou baterias para descarte', pts:40, icon:'üîã', impacto:'M√©dio'},
        {nome:'Planta: Criar hortas ou jardins dom√©sticos', pts:100, icon:'üå≥', impacto:'Alto'},
        {nome:'Planta: Plantar uma Muda ou Semente', pts:40, icon:'üåø', impacto:'M√©dio'},
        {nome:'Planta: Criar uma composteira', pts:100, icon:'üå≥', impacto:'Alto'},
        {nome:'Social: Convidar um colega para usar o app EcoA√ß√£o', pts:40, icon:'ü§ù', impacto:'M√©dio'},
        {nome:'Social: Doar roupas que n√£o usa mais', pts:50, icon:'üëï', impacto:'M√©dio'},
        {nome:'Social: Doar livros ou apostilas antigas', pts:40, icon:'üìö', impacto:'M√©dio'},
        {nome:'Limpeza: Juntar lixo espalhado pelo ch√£o', pts:40, icon:'üßπ', impacto:'M√©dio'},
        {nome:'Limpeza: Deixar a mesa do RU/Lanchonete limpa', pts:20, icon:'üçΩÔ∏è', impacto:'Baixo'},
        {nome:'Limpeza: Ajudar a limpar um canteiro ou pra√ßa', pts:70, icon:'‚ú®', impacto:'Alto'},
        {nome:'Papel: Usar o verso de folhas como rascunho', pts:20, icon:'üìÑ', impacto:'Baixo'},
        {nome:'Papel: Estudar por documentos digitais (sem imprimir)', pts:20, icon:'üì±', impacto:'Baixo'},
        {nome:'Papel: Juntar papel√£o ou jornais para reciclagem', pts:30, icon:'üì¶', impacto:'M√©dio'},
        {nome:'Transporte: Vir para a faculdade a p√©', pts:40, icon:'üö∂', impacto:'M√©dio'},
        {nome:'Transporte: Vir para a faculdade de bicicleta', pts:50, icon:'üö≤', impacto:'Alto'},
        {nome:'Transporte: Usar √¥nibus ou transporte p√∫blico', pts:30, icon:'üöå', impacto:'M√©dio'},
        {nome:'Pl√°stico: Usar sacola de pano (Ecobag) para compras', pts:30, icon:'üõçÔ∏è', impacto:'M√©dio'},
        {nome:'Pl√°stico: Usar seus pr√≥prios talheres (reutiliz√°veis)', pts:30, icon:'üç¥', impacto:'M√©dio'},
        {nome:'Pl√°stico: Recusar canudinhos e copos descart√°veis', pts:15, icon:'ü•§', impacto:'Baixo'},
        {nome:'Geral: Criar algo novo com material reciclado', pts:60, icon:'üé®', impacto:'Alto'},
        {nome:'Geral: Participar de uma palestra ambiental', pts:50, icon:'üéì', impacto:'M√©dio'},
        {nome:'Geral: Completar 3 a√ß√µes sustent√°veis', pts:60, icon:'üî•', impacto:'Alto'}
    ];

    onAuthStateChanged(auth, async user => {
        if (!user) { location.href="login.html"; return; }

        const q = query(collection(db, "acoes_pendentes"), where("uid", "==", user.uid));
        const snap = await getDocs(q);
        const statusMap = {};
        snap.forEach(d => statusMap[d.data().acao] = d.data().status);

        const grid = document.getElementById("listaAcoes");
        grid.innerHTML = ""; // Garante que come√ßa vazio

        acoes.forEach((a, i) => {
            const s = statusMap[a.nome];
            let htmlStatus = "";

            if (s === 'pendente') {
                htmlStatus = '<div class="status-badge pendente">‚è≥ Pendente</div>';
            } else if (s === 'aprovada') {
                htmlStatus = '<div class="status-badge aprovado">‚úÖ Conclu√≠do</div>';
            } else {
                htmlStatus = `
                    <input type="file" id="f-${i}" accept="image/*" style="font-size:0.7rem; margin:10px 0;">
                    <button class="btn-enviar" onclick="enviarAcao(${i})">Enviar</button>
                `;
            }

            grid.innerHTML += `
                <div class="card">
                    <div style="font-size:2.5rem">${a.icon}</div>
                    <h3>${a.nome}</h3>
                    <span class="pts">${a.pts} pts</span>
                    ${htmlStatus}
                </div>`;
        });

        // Fun√ß√£o global para o bot√£o funcionar
        window.enviarAcao = async (idx) => {
            const fileInput = document.getElementById(`f-${idx}`);
            const file = fileInput.files[0];
            if(!file) return alert("Selecione uma foto!");

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async (e) => {
                try {
                    await addDoc(collection(db, "acoes_pendentes"), { 
                        uid: user.uid, 
                        email: user.email, 
                        acao: acoes[idx].nome, 
                        pontos: acoes[idx].pts, 
                        status: "pendente", 
                        comprovanteBase64: e.target.result, 
                        criadoEm: serverTimestamp() 
                    });
                    alert("Enviado para an√°lise!"); 
                    location.reload();
                } catch (err) {
                    alert("Erro ao enviar: " + err.message);
                }
            };
        };
    });
</script>
</body>
</html>




