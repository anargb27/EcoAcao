<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Admin ‚Äì EcoA√ß√£o Acad√™mica</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --verde-dark: #1b5e20;
            --verde-primary: #2e7d32;
            --verde-light: #43a047;
            --vermelho: #d32f2f;
            --bg: #f0f2f5;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            margin: 0;
            color: #333;
            padding-bottom: 50px;
        }

        header {
            background: linear-gradient(135deg, var(--verde-dark), var(--verde-primary));
            color: #fff;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 0 20px;
        }

        h2 { color: var(--verde-dark); border-bottom: 2px solid #ddd; padding-bottom: 10px; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.2s;
            overflow: hidden; /* EVITA QUE A IMAGEM VAZE */
        }

        .card:hover { transform: translateY(-3px); }

        .user-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .acao-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--verde-primary);
            margin: 5px 0;
        }

        /* AJUSTE NA IMAGEM PARA FICAR SEMPRE ALINHADA */
        .comprovante-img {
            width: 100%;
            height: 180px; /* Altura fixa para todos os cards */
            object-fit: cover; /* Preenche o espa√ßo sem distorcer ou vazar */
            background: #000;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
        }

        .actions { display: flex; gap: 10px; margin-top: 15px; }

        button {
            flex: 1; border: none; padding: 12px; border-radius: 8px;
            cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.3s;
        }

        .btn-aprovar { background: var(--verde-light); color: white; }
        .btn-aprovar:hover { background: var(--verde-dark); }

        .btn-rejeitar { background: #ffebee; color: var(--vermelho); border: 1px solid var(--vermelho); }
        .btn-rejeitar:hover { background: var(--vermelho); color: white; }
    </style>
</head>
<body id="adminBody" style="display:none;"> <header>
    <h1>üõ°Ô∏è Painel Admin</h1>
    <button onclick="logout()" style="background:rgba(255,255,255,0.2); border:none; color:white; padding: 5px 15px; border-radius:15px; cursor:pointer;">Sair</button>
</header>

<div class="container">
    <h2>A√ß√µes Pendentes de Aprova√ß√£o</h2>
    <div id="listaPendentes" class="grid">
        <p style="text-align:center; width:100%">Carregando solicita√ß√µes...</p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, query, where, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAgKsk6jSIQk7AQ35xmVpnSn84pU8ca0g8",
        authDomain: "ecoacao-eda80.firebaseapp.com",
        projectId: "ecoacao-eda80"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
        if (!user) { window.location.href = "login.html"; return; }
        
        const snap = await getDoc(doc(db, "usuarios", user.uid));
        if (snap.exists() && snap.data().admin === true) {
            document.getElementById("adminBody").style.display = "block";
            carregarPendentes();
        } else {
            window.location.replace("dashboard.html");
        }
    });

    function carregarPendentes() {
        const q = query(collection(db, "acoes_pendentes"), where("status", "==", "pendente"));
        onSnapshot(q, (snapshot) => {
            const list = document.getElementById("listaPendentes");
            list.innerHTML = snapshot.empty ? "<p>Nenhuma a√ß√£o pendente.</p>" : "";
            
            snapshot.forEach(d => {
                const a = d.data();
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
                    <div>
                        <div class="user-info">üë§ ${a.nome || 'Usu√°rio'} | ${a.curso || 'S/C'}</div>
                        <div class="acao-title">${a.acao}</div>
                        <div style="color:var(--verde-dark); font-weight:bold">+${a.pontos} Pontos</div>
                        <img src="${a.comprovanteBase64}" class="comprovante-img" onclick="window.open(this.src)">
                    </div>
                    <div class="actions">
                        <button class="btn-rejeitar" onclick="rejeitar('${d.id}')">Rejeitar</button>
                        <button class="btn-aprovar" onclick="aprovar('${d.id}', '${a.uid}', ${a.pontos})">Aprovar</button>
                    </div>`;
                list.appendChild(card);
            });
        });
    }

    window.aprovar = async (did, uid, pts) => {
        if(!confirm("Aprovar a√ß√£o?")) return;
        await updateDoc(doc(db, "acoes_pendentes", did), { status: "aprovada" });
        await updateDoc(doc(db, "usuarios", uid), { pontos: increment(pts) });
    };

    window.rejeitar = async (id) => {
        const m = prompt("Motivo da rejei√ß√£o:");
        if (m) await updateDoc(doc(db, "acoes_pendentes", id), { status: "rejeitada", motivoRejeicao: m });
    };

    window.logout = () => signOut(auth).then(() => location.href = "login.html");
</script>
</body>
</html>

