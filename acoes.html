<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√ß√µes ‚Äì EcoA√ß√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --p: #2e7d32; --s: #43a047; --bg: #f4f8f6; --white: #ffffff; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); padding-bottom: 50px; }
        
        header { 
            background: linear-gradient(135deg, #1b5e20, #2e7d32); 
            color: #fff; padding: 20px 5%; 
            text-align: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .nav-principal { 
            display: flex; 
            justify-content: space-around; 
            padding: 15px; 
            background: #1b5e20; 
        }
        .nav-principal a { color: white; text-decoration: none; font-size: 0.9rem; }
        .nav-principal a.active { font-weight: bold; border-bottom: 2px solid white; }

        .container { max-width: 1100px; margin: 20px auto; padding: 0 20px; }
        
        .filtros { 
            margin-bottom: 20px; 
            display: flex; 
            gap: 8px; 
            flex-wrap: wrap; 
            justify-content: center; 
        }
        .filtros button { 
            background: white; 
            border: 1px solid var(--p); 
            color: var(--p); 
            padding: 8px 15px; 
            border-radius: 20px; 
            cursor: pointer; 
            font-family: 'Poppins';
            transition: 0.3s;
        }
        .filtros button:hover { background: var(--p); color: white; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        
        .card { 
            background: white; border-radius: 20px; padding: 20px; 
            text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
            display: flex; flex-direction: column; justify-content: space-between; 
        }
        .card h3 { font-size: 1rem; margin: 10px 0; color: #333; }
        .pts { font-weight: 700; color: var(--p); background: #f0f7f0; padding: 5px 10px; border-radius: 10px; display: inline-block; }
        
        .btn-enviar { background: var(--p); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: 600; margin-top: 10px; }
        .status-badge { padding: 10px; border-radius: 10px; font-size: 0.8rem; font-weight: 600; margin-top: 10px; }
        .pendente { background: #fffde7; color: #fbc02d; }
        .aprovado { background: #e8f5e9; color: #2e7d32; }
    </style>
</head>
<body>

<nav class="nav-principal">
    <a href="dashboard.html">üè† In√≠cio</a>
    <a href="acoes.html" class="active">üå± A√ß√µes</a>
    <a href="ranking.html">üèÜ Ranking</a>
</nav>

<header>
    <h1 style="margin:0; font-size:1.5rem;">üå± EcoA√ß√µes Dispon√≠veis</h1>
</header>

<div class="container">
    <div class="filtros">
        <button onclick="filtrar('Todas')">Todas</button>
        <button onclick="filtrar('√Ågua')">üíß √Ågua</button>
        <button onclick="filtrar('Energia')">‚ö° Energia</button>
        <button onclick="filtrar('Reciclagem')">‚ôªÔ∏è Reciclagem</button>
        <button onclick="filtrar('Planta')">üå± Planta</button>
    </div>

    <div class="grid" id="listaAcoes">
        </div>
</div>
    
        <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyAgKsk6jSIQk7AQ35xmVpnSn84pU8ca0g8", 
        authDomain: "ecoacao-eda80.firebaseapp.com", 
        projectId: "ecoacao-eda80" 
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const acoes = [
        {categoria: '√Ågua', nome:'√Ågua: Usar garrafa pr√≥pria (reutiliz√°vel)', pts:15, icon:'ü•§'},
        {categoria: '√Ågua', nome:'√Ågua: Reutilizar √Ågua Para Atividade Dom√©sticas', pts:20, icon:'üí¶'},
        {categoria: '√Ågua', nome:'√Ågua: Aproveitar a √°gua da chuva', pts:40, icon:'ü™£'},
        {categoria: 'Energia', nome:'Energia: Apagar luzes de c√¥modos vazios', pts:15, icon:'üí°'},
        {categoria: 'Energia', nome:'Energia: Tirar eletrodom√©sticos da tomada', pts:15, icon:'üîå'},
        {categoria: 'Energia', nome:'Energia: Escolher a escada em vez do elevador', pts:20, icon:'üèÉ'},
        {categoria: 'Reciclagem', nome:'Reciclagem: Separar res√≠duos s√≥lidos', pts:25, icon:'‚ôªÔ∏è'},
        {categoria: 'Reciclagem', nome:'Reciclagem: Encaminhar materiais para coleta', pts:50, icon:'‚ôªÔ∏è'},
        {categoria: 'Reciclagem', nome:'Reciclagem: Juntar pilhas para descarte', pts:40, icon:'üîã'},
        {categoria: 'Planta', nome:'Planta: Criar hortas ou jardins dom√©sticos', pts:100, icon:'üå≥'},
        {categoria: 'Planta', nome:'Planta: Plantar uma Muda ou Semente', pts:40, icon:'üåø'},
        {categoria: 'Planta', nome:'Planta: Criar uma composteira', pts:100, icon:'üå≥'},
        {categoria: 'Social', nome:'Social: Convidar um colega para o app', pts:40, icon:'ü§ù'},
        {categoria: 'Social', nome:'Social: Doar roupas que n√£o usa mais', pts:50, icon:'üëï'},
        {categoria: 'Social', nome:'Social: Doar livros ou apostilas antigas', pts:40, icon:'üìö'},
        {categoria: 'Limpeza', nome:'Limpeza: Juntar lixo espalhado pelo ch√£o', pts:40, icon:'üßπ'},
        {categoria: 'Limpeza', nome:'Limpeza: Deixar a mesa do RU limpa', pts:20, icon:'üçΩÔ∏è'},
        {categoria: 'Limpeza', nome:'Limpeza: Ajudar a limpar uma pra√ßa', pts:70, icon:'‚ú®'},
        {categoria: 'Papel', nome:'Papel: Usar o verso de folhas como rascunho', pts:20, icon:'üìÑ'},
        {categoria: 'Papel', nome:'Papel: Estudar por documentos digitais', pts:20, icon:'üì±'},
        {categoria: 'Papel', nome:'Papel: Juntar papel√£o para reciclagem', pts:30, icon:'üì¶'},
        {categoria: 'Transporte', nome:'Transporte: Vir para a faculdade a p√©', pts:40, icon:'üö∂'},
        {categoria: 'Transporte', nome:'Transporte: Vir para a faculdade de bicicleta', pts:50, icon:'üö≤'},
        {categoria: 'Transporte', nome:'Transporte: Usar √¥nibus ou transporte p√∫blico', pts:30, icon:'üöå'},
        {categoria: 'Pl√°stico', nome:'Pl√°stico: Usar sacola de pano (Ecobag)', pts:30, icon:'üõçÔ∏è'},
        {categoria: 'Pl√°stico', nome:'Pl√°stico: Usar seus pr√≥prios talheres', pts:30, icon:'üç¥'},
        {categoria: 'Pl√°stico', nome:'Pl√°stico: Recusar descart√°veis', pts:15, icon:'ü•§'},
        {categoria: 'Geral', nome:'Geral: Criar algo novo com material reciclado', pts:60, icon:'üé®'},
        {categoria: 'Geral', nome:'Geral: Participar de uma palestra ambiental', pts:50, icon:'üéì'},
        {categoria: 'Geral', nome:'Geral: Completar 3 a√ß√µes sustent√°veis', pts:60, icon:'üî•'}
    ];

    onAuthStateChanged(auth, async user => {
        if (!user) { location.href="login.html"; return; }

        const q = query(collection(db, "acoes_pendentes"), where("uid", "==", user.uid));
        const snap = await getDocs(q);
        const statusMap = {};
        snap.forEach(d => statusMap[d.data().acao] = d.data().status);

        window.renderizarAcoes = (filtro = 'Todas') => {
            const grid = document.getElementById("listaAcoes");
            grid.innerHTML = "";

            acoes.forEach((a, i) => {
                if (filtro !== 'Todas' && a.categoria !== filtro) return;

                const s = statusMap[a.nome];
                let htmlStatus = s === 'pendente' ? '<div class="status-badge pendente">‚è≥ Pendente</div>' : 
                                 s === 'aprovada' ? '<div class="status-badge aprovado">‚úÖ Conclu√≠do</div>' :
                                 `<input type="file" id="f-${i}" accept="image/*" style="font-size:0.7rem; margin:10px 0;">
                                  <button class="btn-enviar" onclick="enviarAcao(${i})">Enviar</button>`;

                grid.innerHTML += `
                    <div class="card">
                        <div style="font-size:2.5rem">${a.icon}</div>
                        <h3>${a.nome}</h3>
                        <span class="pts">${a.pts} pts</span>
                        ${htmlStatus}
                    </div>`;
            });
        };

        window.filtrar = (cat) => renderizarAcoes(cat);
        renderizarAcoes();

        window.enviarAcao = async (idx) => {
            const file = document.getElementById(`f-${idx}`).files[0];
            if(!file) return alert("Selecione uma foto!");

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async (e) => {
                try {
                    await addDoc(collection(db, "acoes_pendentes"), { 
                        uid: user.uid, 
                        email: user.email, 
                        acao: acoes[idx].nome, 
                        pontos: acoes[idx].pts, 
                        status: "pendente", 
                        comprovanteBase64: e.target.result, 
                        criadoEm: serverTimestamp() 
                    });
                    alert("Enviado para an√°lise!"); 
                    location.reload();
                } catch (err) {
                    alert("Erro: " + err.message);
                }
            };
        };
    });
</script>
</body>
</html>





